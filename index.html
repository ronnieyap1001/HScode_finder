<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HS Code Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    td[contenteditable="true"]:focus { outline: 2px solid rgba(59,130,246,0.5); }
    .mono { font-feature-settings: 'tnum' on, 'lnum' on; font-variant-numeric: tabular-nums lining-nums; }
    .bullets { white-space: pre-line; }
  </style>
  <!--
    Cloudflare setup (proxy that hides your OpenAI key):
    1) Create a Worker and paste this code:

    export default {
      async fetch(req, env) {
        if (req.method !== 'POST') return new Response('Only POST', { status: 405 });
        const body = await req.json();
        // Expect { model, temperature, messages }
        const r = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${env.OPENAI_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });
        return new Response(r.body, { headers: { 'Content-Type': 'application/json' } });
      }
    }

    2) In the Worker -> Settings -> Variables, add OPENAI_API_KEY with your key.
    3) Deploy. Copy the Worker URL (e.g. https://your-worker.workers.dev)
    4) Set CF_WORKER_URL below to that URL.
  -->
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-6xl mx-auto p-6 space-y-6">
    <header>
      <h1 class="text-2xl md:text-3xl font-bold">HS Code Finder</h1>
      <p class="text-sm text-gray-600 mt-1">
        Describe the item and optional usage, click <em>Submit</em> to generate HS code(s) with AI.
        If the input is not detailed enough, the AI may return up to 3 possible HS codes.
        This tool always uses <b>GPT-4.1-nano</b> via your Cloudflare Worker.
      </p>
    </header>

    <section class="bg-white shadow rounded-2xl overflow-hidden">
      <div class="overflow-x-auto">
        <table id="hsTable" class="min-w-full table-fixed">
          <thead class="bg-gray-100">
            <tr>
              <th class="w-[25%] px-3 py-2 text-left text-sm font-semibold text-gray-700">Describe the Item</th>
              <th class="w-[35%] px-3 py-2 text-left text-sm font-semibold text-gray-700">Usage (Optional)</th>
              <th class="w-[15%] px-3 py-2 text-left text-sm font-semibold text-gray-700">HS Code(s)</th>
              <th class="w-[25%] px-3 py-2 text-left text-sm font-semibold text-gray-700">HS Code description(s)</th>
            </tr>
          </thead>
          <tbody id="tbody" class="divide-y divide-gray-100"></tbody>
        </table>
      </div>
    </section>

    <section class="flex flex-wrap gap-3">
      <button id="submitBtn" class="px-5 py-2.5 rounded-2xl bg-blue-600 text-white font-semibold shadow hover:bg-blue-700">Submit</button>
      <button id="clearBtn" class="px-5 py-2.5 rounded-2xl bg-gray-200 text-gray-800 font-semibold shadow hover:bg-gray-300">Reset</button>
      <button id="exportBtn" class="px-5 py-2.5 rounded-2xl bg-emerald-600 text-white font-semibold shadow hover:bg-emerald-700">Export as CSV</button>
      <button id="copyBtn" class="px-5 py-2.5 rounded-2xl bg-indigo-600 text-white font-semibold shadow hover:bg-indigo-700">Copy Table</button>
      <span id="status" class="self-center text-sm text-gray-600"></span>
    </section>
  </div>

  <script>
    const tbody = document.getElementById('tbody');
    const DEFAULT_ROWS = 5;

    // --------------- Configure this to your Worker URL ---------------
    const CF_WORKER_URL = 'https://hscodefinder.ronnieyap1001.workers.dev/';
